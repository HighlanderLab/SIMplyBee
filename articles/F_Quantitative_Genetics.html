<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantitative genetics • SIMplyBee</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quantitative genetics">
<meta property="og:description" content="SIMplyBee">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIMplyBee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question-circle"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_Introduction_to_honeybee_biology.html">Introduction to honeybee biology</a>
    </li>
    <li>
      <a href="../articles/C_Colony_events.html">Colony Events</a>
    </li>
    <li>
      <a href="../articles/B_Multiple_colonies.html">Multiple colonies</a>
    </li>
    <li>
      <a href="../articles/D_Crossing.html">Crossing</a>
    </li>
    <li>
      <a href="../articles/E_Genomics.html">Genomics</a>
    </li>
    <li>
      <a href="../articles/G_Sampling_functions.html">Sampling functions</a>
    </li>
    <li>
      <a href="../articles/F_Quantitative_Genetics.html">Quantitative Genetics</a>
    </li>
    <li>
      <a href="../articles/Z_FAQs.html">FAQs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HighlanderLab/SIMplyBee/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantitative genetics</h1>
            
            <h4 data-toc-skip class="date">2024-06-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HighlanderLab/SIMplyBee/blob/HEAD/vignettes/F_Quantitative_Genetics.Rmd" class="external-link"><code>vignettes/F_Quantitative_Genetics.Rmd</code></a></small>
      <div class="hidden name"><code>F_Quantitative_Genetics.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes and demonstrates how SIMplyBee implements
quantitative genetics principles for honeybees. Specifically, it
describes three different examples where we simulate:</p>
<ol style="list-style-type: decimal">
<li><p>Honey yield - a single colony trait,</p></li>
<li><p>Honey yield and Calmness - two colony traits, and</p></li>
<li><p>Colony strength and Honey yield - two colony traits where one
trait impacts the other one via the number of workers.</p></li>
</ol>
<p>We start by loading SIMplyBee and quickly simulating genomes for some
founder honeybees. Specifically, we will simulate genomes for 20
individuals with 16 chromosomes and 1000 segregating sites per
chromosome.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"SIMplyBee"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: AlphaSimR</span></span>
<span><span class="co">#&gt; Loading required package: R6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'SIMplyBee'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     split</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="va">founderGenomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://gaynorr.github.io/AlphaSimR/reference/quickHaplo.html" class="external-link">quickHaplo</a></span><span class="op">(</span>nInd <span class="op">=</span> <span class="fl">20</span>, nChr <span class="op">=</span> <span class="fl">16</span>, segSites <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="honey-yield">Honey yield<a class="anchor" aria-label="anchor" href="#honey-yield"></a>
</h2>
<p>This section shows how to simulate one colony trait, honey yield,
that is influenced by the queen and workers as well as the environment.
We will achieve this by:</p>
<ol style="list-style-type: lower-alpha">
<li>setting base population quantitative genetic parameters,</li>
<li>inspecting individual values in the base population,</li>
<li>inspecting individual values in a colony,</li>
<li>calculating colony value,</li>
<li>calculating multi-colony values, and</li>
<li>selecting on colony values.</li>
</ol>
<div class="section level3">
<h3 id="base-population-quantitative-genetic-parameters">Base population quantitative genetic parameters<a class="anchor" aria-label="anchor" href="#base-population-quantitative-genetic-parameters"></a>
</h3>
<p>AlphaSimR, and hence SIMplyBee, simulates each individual with its
corresponding genome, and quantitative genetic and phenotypic values. To
enable this simulation, we must set base population quantitative genetic
parameters for the traits of interest in the global simulation
parameters via <code>SimParamBee</code>. We must set:</p>
<ol style="list-style-type: decimal">
<li>the number of traits,</li>
<li>the number of quantitative trait loci (QTL) that affect the
traits,</li>
<li>the distribution of QTL effects,</li>
<li>trait means, and</li>
<li>trait genetic and environmental variances - if we simulate multiple
traits, we must also specify genetic and environmental covariances
between the traits.</li>
</ol>
<p>In honeybees, the majority of traits are influenced by the queen and
workers. There are many biological mechanisms for these queen and
workers effects. Depending on which caste is the main driver of the
trait (the queen or workers), we also talk about direct and indirect
effects. For example, for honey yield, workers directly affect honey
yield by foraging, while the queen indirectly affects honey yield by
stimulating workers via pheromone production. The queen and workers
effects for a trait can be genetically and environmentally independent
or correlated (usually negatively).</p>
<p>Here, we will simulate two traits to represent the queen and workers
effects on honey yield. From this point onward we will use the terms the
queen effect and queen trait interchangeably. The same applies to
workers effect and workers trait. These two effects (=traits) will give
rise to honey yield trait. We will assume that colony honey yield is
approximately normally distributed with the mean of 20 kg and variance
of 4 <span class="math inline">\(kg^2\)</span>, which implies that most
colonies will have honey yield between 14 kg and 26 kg (see
<code>hist(rnorm(n = 1000, mean = 20, sd = sqrt(4)))</code>). Traits
like honey yield have a complex polygenic genetic architecture, so we
will assume that this trait is influenced by 100 QTL per chromosome
(with 16 chromosomes, this gives us 1600 QTL in total).</p>
<p>We will first initiate global simulation parameters and set the mean
of queen effects to 10 kg with genetic variance of 1 <span class="math inline">\(kg^2\)</span>, while we will set the mean of
workers effects to 10 kg with genetic variance of 1 <span class="math inline">\(kg^2\)</span>. The mean and the variance for the
worker effect are proportionally scaled by the expected number of
workers in a colony. The mean and variance for the queen effect is
assumed larger than for the workers effect, because there is one queen
and many workers in colony and we assume that workers effects
“accumulate”. Deciding how to split the colony mean between queen and
workers effects will depend on the individual to colony mapping
function, which we will describe in the Colony value sub-section.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Global simulation parameters</span></span>
<span><span class="va">SP</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimParamBee.html">SimParamBee</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nQtlPerChr</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Genetic parameters for queen and workers effects - each represented by a trait</span></span>
<span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">varA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span></code></pre></div>
<p>We next set genetic correlation between the queen and workers effects
to -0.5 to reflect the commonly observed antagonistic relationship
between these effects. With all the quantitative genetic parameters
defined, we now add two additive traits to global simulation parameters
and name them <code>queenTrait</code> and <code>workerTrait</code>.
These parameters drive the simulation of QTL effects. Read about all the
other trait simulation options in AlphaSimR via:
<code><a href="https://gaynorr.github.io/AlphaSimR/articles/traits.html" class="external-link">vignette(topic = "traits", package="AlphaSimR")</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>, </span>
<span>                        <span class="op">-</span><span class="fl">0.5</span>,  <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">addTraitA</span><span class="op">(</span>nQtlPerChr <span class="op">=</span> <span class="va">nQtlPerChr</span>, mean <span class="op">=</span> <span class="va">mean</span>, var <span class="op">=</span> <span class="va">varA</span>, corA <span class="op">=</span> <span class="va">corA</span>,</span>
<span>             name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"queenTrait"</span>, <span class="st">"workersTrait"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we set the environmental variance of the queen and workers
effects to 3 <span class="math inline">\(kg^2\)</span> and we again
scale the worker variance by the expected number of workers. Contrary to
the negative genetic correlation, we here assume that environmental
correlation between the queen and workers effects is slightly positive,
0.3. This is just an example! These parameters should be based on
literature or simulation scenarios of interest.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.3</span>, </span>
<span>                        <span class="fl">0.3</span>, <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">setVarE</span><span class="op">(</span>varE <span class="op">=</span> <span class="va">varE</span>, corE <span class="op">=</span> <span class="va">corE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="individual-values-in-the-base-population">Individual values in the base population<a class="anchor" aria-label="anchor" href="#individual-values-in-the-base-population"></a>
</h3>
<p>Now we create a base population of virgin queens. Since we defined
two traits, all honeybees in the simulation will have genetic and
phenotypic values for both traits. The genetic values are stored in the
<code>gv</code> slot of each <code>Pop</code> object, while phenotypic
values are stored in the <code>pheno</code> slot.</p>
<pre><code><span><span class="co">#&gt;      queenTrait workersTrait</span></span>
<span><span class="co">#&gt; [1,]   9.308097  0.175604495</span></span>
<span><span class="co">#&gt; [2,]   9.229212  0.177669761</span></span>
<span><span class="co">#&gt; [3,]   7.838815  0.145594578</span></span>
<span><span class="co">#&gt; [4,]   9.031639  0.248186228</span></span>
<span><span class="co">#&gt; [5,]   9.868613  0.009881919</span></span>
<span><span class="co">#&gt; [6,]   9.378971  0.152665945</span></span>
<span><span class="co">#&gt;      queenTrait workersTrait</span></span>
<span><span class="co">#&gt; [1,]   8.891549   0.09371756</span></span>
<span><span class="co">#&gt; [2,]  10.186057   0.32952109</span></span>
<span><span class="co">#&gt; [3,]   5.871084   0.28238299</span></span>
<span><span class="co">#&gt; [4,]   7.980709   0.07262322</span></span>
<span><span class="co">#&gt; [5,]  10.666579   0.11525851</span></span>
<span><span class="co">#&gt; [6,]  10.698284   0.06826125</span></span></code></pre>
<p><img src="F_Quantitative_Genetics_files/figure-html/basePop_virgin_queens-1.png" width="576"></p>
<p>Note that these are virgin queens, yet we obtained queen and workers
effect values for them! Is this wrong? No! Virgin queens carry DNA with
genes that are differentially expressed in different castes, which would
be only showed in their phenotype. Hence, virgin queens have genetic
values for the queen and worker effects, but they might never actually
express these effects. In this simulation virgin queens also obtained
phenotypic values for both of the effects. This is technically incorrect
because virgin queens don’t express genes for the worker effect at all,
and they also do not express the queen effect, not until they become the
queen of a colony. We can treat these phenotypic values for virgin
queens as values that we could see if these virgin queens would express
these traits. We will show later in the Colony value sub-section how we
use these traits from different castes. If existence of these phenotypic
values for certain castes is a hindrance, we can always remove them for
population or colony objects by modifying the corresponding slots as
required.</p>
<p>As with the virgin queens, drones also carry DNA with genes that are
expressed in different castes. Therefore, drones will also have the
queen and workers effect genetic (and phenotypic values) for honey yield
even though they do not contribute to this trait in a colony.</p>
<pre><code><span><span class="co">#&gt;      queenTrait workersTrait</span></span>
<span><span class="co">#&gt; [1,]   9.954598   0.15540719</span></span>
<span><span class="co">#&gt; [2,]   9.295143   0.02608700</span></span>
<span><span class="co">#&gt; [3,]   8.607203   0.30149989</span></span>
<span><span class="co">#&gt; [4,]   8.936181   0.16276061</span></span>
<span><span class="co">#&gt; [5,]   9.810361   0.35394535</span></span>
<span><span class="co">#&gt; [6,]  10.841326   0.09418303</span></span></code></pre>
<p><img src="F_Quantitative_Genetics_files/figure-html/basePop_drones-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="individual-values-in-a-colony">Individual values in a colony<a class="anchor" aria-label="anchor" href="#individual-values-in-a-colony"></a>
</h3>
<p>We continue by creating a colony from one base population virgin
queen, crossing it, and adding some workers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createColony.html">createColony</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basePop</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">colony</span>, drones <span class="op">=</span> <span class="va">drones</span>, checkCross <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCastePop.html">addWorkers</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">colony</span>, nInd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">colony</span></span>
<span><span class="co">#&gt; An object of class "Colony" </span></span>
<span><span class="co">#&gt; Id: 1 </span></span>
<span><span class="co">#&gt; Location: 0 0 </span></span>
<span><span class="co">#&gt; Queen: 6 </span></span>
<span><span class="co">#&gt; Number of fathers: 15 </span></span>
<span><span class="co">#&gt; Number of workers: 50 </span></span>
<span><span class="co">#&gt; Number of drones: 0 </span></span>
<span><span class="co">#&gt; Number of virgin queens: 0 </span></span>
<span><span class="co">#&gt; Has split: FALSE </span></span>
<span><span class="co">#&gt; Has swarmed: FALSE </span></span>
<span><span class="co">#&gt; Has superseded: FALSE </span></span>
<span><span class="co">#&gt; Has collapsed: FALSE </span></span>
<span><span class="co">#&gt; Is productive: FALSE</span></span></code></pre></div>
<p>We can access the genetic and phenotypic values of colony members
with functions <code><a href="../reference/getGv.html">getGv()</a></code> and <code><a href="../reference/getPheno.html">getPheno()</a></code>, both of
which have the <code>caste</code> argument (see more via
<code><a href="../reference/getGv.html">help(getGv)</a></code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getGv</a></span><span class="op">(</span><span class="va">colony</span>, caste <span class="op">=</span> <span class="st">"queen"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 6   9.378971    0.1526659</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getGv</a></span><span class="op">(</span><span class="va">colony</span>, caste <span class="op">=</span> <span class="st">"workers"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 36   9.543200    0.1599173</span></span>
<span><span class="co">#&gt; 37   9.571113    0.1704331</span></span>
<span><span class="co">#&gt; 38   9.810899    0.1492480</span></span>
<span><span class="co">#&gt; 39   9.420746    0.2266490</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/getPheno.html">getPheno</a></span><span class="op">(</span><span class="va">colony</span>, caste <span class="op">=</span> <span class="st">"queen"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 6   10.69828   0.06826125</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPheno.html">getPheno</a></span><span class="op">(</span><span class="va">colony</span>, caste <span class="op">=</span> <span class="st">"workers"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 36   8.082934   0.03250582</span></span>
<span><span class="co">#&gt; 37   6.765243  -0.06768380</span></span>
<span><span class="co">#&gt; 38  11.382105   0.25480796</span></span>
<span><span class="co">#&gt; 39   9.375424  -0.09480654</span></span></code></pre></div>
<p>For convenience, there are also alias functions for accessing the
genetic and phenotypic values of each caste directly.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 6   9.378971    0.1526659</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getWorkersGv</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 36   9.543200    0.1599173</span></span>
<span><span class="co">#&gt; 37   9.571113    0.1704331</span></span>
<span><span class="co">#&gt; 38   9.810899    0.1492480</span></span>
<span><span class="co">#&gt; 39   9.420746    0.2266490</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/getPheno.html">getQueenPheno</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 6   10.69828   0.06826125</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPheno.html">getWorkersPheno</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 36   8.082934   0.03250582</span></span>
<span><span class="co">#&gt; 37   6.765243  -0.06768380</span></span>
<span><span class="co">#&gt; 38  11.382105   0.25480796</span></span>
<span><span class="co">#&gt; 39   9.375424  -0.09480654</span></span></code></pre></div>
<p>Some phenotypes, such as honey yield, are only expressed if colony is
at full size. This is achieved by the <code><a href="../reference/buildUp.html">buildUp()</a></code> colony
event function that adds worker and drones and hence turns on the
<code>production</code> status of the colony (to <code>TRUE</code>).
SIMplyBee includes a function <code>ìsProductive()</code> to check the
production status of a colony.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if colony is productive</span></span>
<span><span class="fu"><a href="../reference/isProductive.html">isProductive</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Build-up the colony and check the production status again</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="va">colony</span></span>
<span><span class="co">#&gt; An object of class "Colony" </span></span>
<span><span class="co">#&gt; Id: 1 </span></span>
<span><span class="co">#&gt; Location: 0 0 </span></span>
<span><span class="co">#&gt; Queen: 6 </span></span>
<span><span class="co">#&gt; Number of fathers: 15 </span></span>
<span><span class="co">#&gt; Number of workers: 100 </span></span>
<span><span class="co">#&gt; Number of drones: 100 </span></span>
<span><span class="co">#&gt; Number of virgin queens: 0 </span></span>
<span><span class="co">#&gt; Has split: FALSE </span></span>
<span><span class="co">#&gt; Has swarmed: FALSE </span></span>
<span><span class="co">#&gt; Has superseded: FALSE </span></span>
<span><span class="co">#&gt; Has collapsed: FALSE </span></span>
<span><span class="co">#&gt; Is productive: TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/isProductive.html">isProductive</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>For the ease of further demonstration, we now combine workers’ values
into a single data.frame.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collate genetic and phenotypic values of workers</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">id</span>,</span>
<span>                 mother <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">mother</span>,</span>
<span>                 father <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">father</span>,</span>
<span>                 gvQueenTrait <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">gv</span><span class="op">[</span>, <span class="st">"queenTrait"</span><span class="op">]</span>,</span>
<span>                 gvWorkersTrait <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">gv</span><span class="op">[</span>, <span class="st">"workersTrait"</span><span class="op">]</span>,</span>
<span>                 pvQueenTrait <span class="op">=</span>  <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">pheno</span><span class="op">[</span>, <span class="st">"queenTrait"</span><span class="op">]</span>,</span>
<span>                 pvWorkersTrait <span class="op">=</span> <span class="va">colony</span><span class="op">@</span><span class="va">workers</span><span class="op">@</span><span class="va">pheno</span><span class="op">[</span>, <span class="st">"workersTrait"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id mother father gvQueenTrait gvWorkersTrait pvQueenTrait pvWorkersTrait</span></span>
<span><span class="co">#&gt; 1 86      6     27     7.422801     0.13684019     8.534047     0.58410980</span></span>
<span><span class="co">#&gt; 2 87      6     30     8.924602     0.17014956     8.312183    -0.04777531</span></span>
<span><span class="co">#&gt; 3 88      6     32     9.507750     0.21150423     9.868270     0.20883751</span></span>
<span><span class="co">#&gt; 4 89      6     35    10.472495     0.09354345    13.686165     0.13625184</span></span>
<span><span class="co">#&gt; 5 90      6     24     9.230478     0.14470408     9.383379     0.30787610</span></span>
<span><span class="co">#&gt; 6 91      6     33     8.998855     0.11588088    10.648432     0.03313144</span></span></code></pre></div>
<p>To visualise correlation between queen and workers effects in
workers, we plot these effect values against each other.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Covariation between queen and workers effect genetic values in workers</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gvQueenTrait</span>, y <span class="op">=</span> <span class="va">gvWorkersTrait</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Genetic value for the queen effect"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Genetic value for the workers effect"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="F_Quantitative_Genetics_files/figure-html/plot_queen_vs_worker_values-1.png" width="700"></p>
<p>In SIMplyBee, we know genetic values of all individuals, including
drones that the queen mated with (=fathers in a colony)!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variation in patriline genetic values</span></span>
<span><span class="fu"><a href="../reference/getGv.html">getFathersGv</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 21   9.954598   0.15540719</span></span>
<span><span class="co">#&gt; 22   9.295143   0.02608700</span></span>
<span><span class="co">#&gt; 23   8.607203   0.30149989</span></span>
<span><span class="co">#&gt; 24   8.936181   0.16276061</span></span>
<span><span class="co">#&gt; 25   9.810361   0.35394535</span></span>
<span><span class="co">#&gt; 26  10.841326   0.09418303</span></span>
<span><span class="co">#&gt; 27   6.687723   0.01584492</span></span>
<span><span class="co">#&gt; 28   5.945730   0.09393334</span></span>
<span><span class="co">#&gt; 29   8.148936   0.17539318</span></span>
<span><span class="co">#&gt; 30   8.485327   0.25380591</span></span>
<span><span class="co">#&gt; 31  11.816540   0.03099468</span></span>
<span><span class="co">#&gt; 32   9.917757   0.15856906</span></span>
<span><span class="co">#&gt; 33  10.130511  -0.02092018</span></span>
<span><span class="co">#&gt; 34   9.567638  -0.03314646</span></span>
<span><span class="co">#&gt; 35  10.187448   0.03517767</span></span></code></pre></div>
<p>Knowing the father of each worker, we inspect variation in the
distribution of genetic values of worker by the patriline (workers from
a single father drone) for the workers effect.</p>
<p><img src="F_Quantitative_Genetics_files/figure-html/distribution_by_patriline-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="colony-value">Colony value<a class="anchor" aria-label="anchor" href="#colony-value"></a>
</h3>
<p>However, in honeybees we usually don’t observe values on individuals,
but on a colony. SIMplyBee provides functions for mapping individual
values to a colony value. The general function for this is
<code><a href="../reference/calcColonyValue.html">calcColonyValue()</a></code>, which can combine any value and trait
from any caste. There are also aliases <code><a href="../reference/calcColonyValue.html">calcColonyGv()</a></code> and
<code><a href="../reference/calcColonyValue.html">calcColonyPheno()</a></code>. These functions require users to specify
the so-called mapping function (via the <code>FUN</code> argument). The
mapping function specifies queen and workers traits (potentially also
drone traits) and what function we want to apply to each of them before
mapping them to the colony value(s). We can also specify whether the
colony value(s) depend on the production status. For example, if a
colony is not productive, its honey yield would be 0 or unobserved.
SIMplyBee provides a general mapping function
<code><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyValue()</a></code> and aliases
<code><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyGv()</a></code> and
<code><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyPheno()</a></code>. These functions have arguments to
cater for various situations. By default, they first calculate caste
values: leave the queen’s value as it is, sum workers’ values,
potentially sum drones’ values, and lastly sum all these caste values
together into a colony value. Users can provide their own mapping
function(s) too!</p>
<p>We now calculate honey yield for our colony - a single value for the
colony.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Colony phenotype value</span></span>
<span><span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span><span class="va">colony</span>, queenTrait <span class="op">=</span> <span class="st">"queenTrait"</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 24.73999</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">calcColonyPheno</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">mapCasteToColonyPheno</span><span class="op">)</span></span></code></pre></div>
<p>These colony values are not stored in a colony, because they change
as colony changes due to various events. For example, reducing the
number of workers will reduce the colony honey yield.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Colony phenotype value from a reduced colony</span></span>
<span><span class="fu"><a href="../reference/removeCastePop.html">removeWorkers</a></span><span class="op">(</span><span class="va">colony</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span>queenTrait <span class="op">=</span> <span class="st">"queenTrait"</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 17.93991</span></span></code></pre></div>
<p>Please note that we assumed that the queen contributes half to colony
honey yield and workers contribute the other half. This means that
removing workers will still give a non-zero honey yield! This shows that
we have to design the mapping between individual, caste, and colony
values with care!</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Colony phenotype value from a reduced colony</span></span>
<span><span class="fu"><a href="../reference/removeCastePop.html">removeWorkers</a></span><span class="op">(</span><span class="va">colony</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span>queenTrait <span class="op">=</span> <span class="st">"queenTrait"</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 10.84351</span></span></code></pre></div>
<p>Finally, note that SIMplyBee currently does not provide functionality
for breeding values, dominance deviations, and epistatic deviations at
caste and colony levels, despite the availabiliy of AlphaSimR
<code><a href="https://gaynorr.github.io/AlphaSimR/reference/bv.html" class="external-link">bv()</a></code>, <code><a href="https://gaynorr.github.io/AlphaSimR/reference/dd.html" class="external-link">dd()</a></code>, and <code><a href="https://gaynorr.github.io/AlphaSimR/reference/aa.html" class="external-link">aa()</a></code> functions.
This is because we have to check or develop theory on how to calculate
these values across active colonies and hence we currently advise
against the use of AlphaSimR <code><a href="https://gaynorr.github.io/AlphaSimR/reference/bv.html" class="external-link">bv()</a></code>, <code><a href="https://gaynorr.github.io/AlphaSimR/reference/dd.html" class="external-link">dd()</a></code>, and
<code><a href="https://gaynorr.github.io/AlphaSimR/reference/aa.html" class="external-link">aa()</a></code> functions with SIMplyBee as the output of these
functions could be easily misinterpreted.</p>
</div>
<div class="section level3">
<h3 id="multicolony-values">MultiColony values<a class="anchor" aria-label="anchor" href="#multicolony-values"></a>
</h3>
<p>The same functions can be used on a <code>MultiColony</code> class
object. Let’s create an apiary.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMultiColony.html">createMultiColony</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">drones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createDrones</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, nInd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">droneGroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pullDroneGroupsFromDCA.html">pullDroneGroupsFromDCA</a></span><span class="op">(</span><span class="va">drones</span>, n <span class="op">=</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span>, nDrones <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">apiary</span>, drones <span class="op">=</span> <span class="va">droneGroups</span>, checkCross <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span></code></pre></div>
<p>We can extract the genetic and phenotypic values from multiple
colonies in the same manner as from a single colony, by using
<code>get*Gv()</code> and <code>get*Pheno()</code> functions. The output
of these function is a named list with values for each colony or a
single matrix if we set the <code>collapse</code> argument to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 7   10.08004    0.1456341</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`3`</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 8   10.04002    0.1336323</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`</span></span>
<span><span class="co">#&gt;   queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 9   12.31322  -0.03172084</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`5`</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 10   9.612226  0.006590948</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">apiary</span>, collapse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;    queenTrait workersTrait</span></span>
<span><span class="co">#&gt; 7   10.080042  0.145634114</span></span>
<span><span class="co">#&gt; 8   10.040025  0.133632255</span></span>
<span><span class="co">#&gt; 9   12.313221 -0.031720845</span></span>
<span><span class="co">#&gt; 10   9.612226  0.006590948</span></span></code></pre></div>
<p>In a similar manner, we can calculate colony value for all the
colonies in our apiary, where the row names of the output represent
colony IDs.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colonyGv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyGv</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="va">colonyPheno</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">colonyGv</span>, <span class="va">colonyPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt;    colonyGv colonyPheno</span></span>
<span><span class="co">#&gt; 2  23.01272    22.48798</span></span>
<span><span class="co">#&gt; 3  26.99610    28.27928</span></span>
<span><span class="co">#&gt; 4  17.90987    17.12925</span></span>
<span><span class="co">#&gt; 5  16.34201    16.14801</span></span>
<span><span class="co">#&gt; 6  21.40384    22.98991</span></span>
<span><span class="co">#&gt; 7  14.73759    17.32070</span></span>
<span><span class="co">#&gt; 8  24.79562    19.33802</span></span>
<span><span class="co">#&gt; 9  24.34892    26.65767</span></span>
<span><span class="co">#&gt; 10 29.36339    27.00947</span></span>
<span><span class="co">#&gt; 11 15.87963    16.98227</span></span>
<span><span class="co">#&gt; 12 20.99715    21.83299</span></span>
<span><span class="co">#&gt; 13 17.20855    16.40065</span></span>
<span><span class="co">#&gt; 14 25.55818    28.19211</span></span>
<span><span class="co">#&gt; 15 24.13237    24.95040</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selection-on-colony-values">Selection on colony values<a class="anchor" aria-label="anchor" href="#selection-on-colony-values"></a>
</h3>
<p>Since the aim of selection is to select the best individuals or
colonies for the reproduction, we could select the best colony in our
apiary based on either genetic or phenotypic value for grafting the new
generation of virgin queens. We can use the function
<code><a href="../reference/selectColonies.html">selectColonies()</a></code> that takes a matrix of colony values (the
output of <code><a href="../reference/calcColonyValue.html">calcColonyValue()</a></code> function). The default behavior
is to select the colonies with the highest value (argument
<code>selectTop</code> set to <code>TRUE</code>), but you can also
select the colonies with the lowest values (argument
<code>selectTop</code> set to <code>FALSE</code>).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the best colony based on gv</span></span>
<span><span class="fu"><a href="../reference/selectColonies.html">selectColonies</a></span><span class="op">(</span><span class="va">apiary</span>, n <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="va">colonyGv</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "MultiColony" </span></span>
<span><span class="co">#&gt; Number of colonies: 1 </span></span>
<span><span class="co">#&gt; Are empty: 0 </span></span>
<span><span class="co">#&gt; Are NULL: 0 </span></span>
<span><span class="co">#&gt; Have split: 0 </span></span>
<span><span class="co">#&gt; Have swarmed: 0 </span></span>
<span><span class="co">#&gt; Have superseded: 0 </span></span>
<span><span class="co">#&gt; Have collapsed: 0 </span></span>
<span><span class="co">#&gt; Are productive: 0</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the best colony based on phenotype</span></span>
<span><span class="fu"><a href="../reference/selectColonies.html">selectColonies</a></span><span class="op">(</span><span class="va">apiary</span>, n <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="va">colonyPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class "MultiColony" </span></span>
<span><span class="co">#&gt; Number of colonies: 1 </span></span>
<span><span class="co">#&gt; Are empty: 0 </span></span>
<span><span class="co">#&gt; Are NULL: 0 </span></span>
<span><span class="co">#&gt; Have split: 0 </span></span>
<span><span class="co">#&gt; Have swarmed: 0 </span></span>
<span><span class="co">#&gt; Have superseded: 0 </span></span>
<span><span class="co">#&gt; Have collapsed: 0 </span></span>
<span><span class="co">#&gt; Are productive: 0</span></span></code></pre></div>
<p>The same functionality is implemented in <code><a href="../reference/pullColonies.html">pullColonies()</a></code>
and <code><a href="../reference/removeColonies.html">removeColonies()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="honey-yield-and-calmness">Honey yield and Calmness<a class="anchor" aria-label="anchor" href="#honey-yield-and-calmness"></a>
</h2>
<p>In this section we expand simulation to two uncorrelated colony
traits with queen and workers effects, honey yield and calmness. We
follow the same recipe as in the previous section where we simulated
only one colony trait.</p>
<p>We first reinitialize the global simulation parameters because we
will define new traits. For honey yield we will use the same parameters
as before, while for calmness trait we will assume that the trait is
scored continuously in such a way that negative values are undesirable
and positive values are desirable with zero being population mean. We
will further assume the same variances for calmness as for honey yield,
and a genetic (and environmental) correlation between the queen and
workers effects of -0.4 (and 0.2) for calmness. We assume no genetic or
environmental correlation between honey yield and calmness. Beware, this
is just an example to show you how to simulate multiple colony traits -
we have made up these parameters - please use literature estimates in
your simulations!</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Global simulation parameters</span></span>
<span><span class="va">SP</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimParamBee.html">SimParamBee</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nQtlPerChr</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Quantitative genetic parameters - for two traits, each with the queen and workers effects</span></span>
<span><span class="va">meanP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">varA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>,  <span class="fl">0.0</span>,  <span class="fl">0.0</span>, </span>
<span>                        <span class="op">-</span><span class="fl">0.5</span>,  <span class="fl">1.0</span>,  <span class="fl">0.0</span>,  <span class="fl">0.0</span>,</span>
<span>                         <span class="fl">0.0</span>,  <span class="fl">0.0</span>,  <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.4</span>, </span>
<span>                         <span class="fl">0.0</span>,  <span class="fl">0.0</span>, <span class="op">-</span><span class="fl">0.4</span>,  <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">addTraitA</span><span class="op">(</span>nQtlPerChr <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="va">meanP</span>, var <span class="op">=</span> <span class="va">varA</span>, corA <span class="op">=</span> <span class="va">corA</span>,</span>
<span>             name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yieldQueenTrait"</span>, <span class="st">"yieldWorkersTrait"</span>,</span>
<span>                      <span class="st">"calmQueenTrait"</span>, <span class="st">"calmWorkersTrait"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">varE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span>, <span class="fl">3</span>, <span class="fl">3</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.3</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>,</span>
<span>                        <span class="fl">0.3</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>,</span>
<span>                        <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.2</span>,</span>
<span>                        <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.2</span>, <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">setVarE</span><span class="op">(</span>varE <span class="op">=</span> <span class="va">varE</span>, corE <span class="op">=</span> <span class="va">corE</span><span class="op">)</span></span></code></pre></div>
<p>We continue by creating a base population of virgin queens and from
them an apiary with 10 full-sized colonies.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basePop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createVirginQueens</a></span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span><span class="va">drones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createDrones</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basePop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, nInd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMultiColony.html">createMultiColony</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">droneGroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pullDroneGroupsFromDCA.html">pullDroneGroupsFromDCA</a></span><span class="op">(</span><span class="va">drones</span>, <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span>, nDrones <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">apiary</span>, drones <span class="op">=</span> <span class="va">droneGroups</span>, checkCross <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="va">apiary</span></span>
<span><span class="co">#&gt; An object of class "MultiColony" </span></span>
<span><span class="co">#&gt; Number of colonies: 15 </span></span>
<span><span class="co">#&gt; Are empty: 0 </span></span>
<span><span class="co">#&gt; Are NULL: 0 </span></span>
<span><span class="co">#&gt; Have split: 0 </span></span>
<span><span class="co">#&gt; Have swarmed: 0 </span></span>
<span><span class="co">#&gt; Have superseded: 0 </span></span>
<span><span class="co">#&gt; Have collapsed: 0 </span></span>
<span><span class="co">#&gt; Are productive: 15</span></span></code></pre></div>
<p>We can again inspect the genetic (and phenotypic) values of all
individuals in each colony and whole apiary with <code>get*Gv()</code>
and <code>get*Pheno()</code> functions. Now, the output contains four
traits representing the queen and workers effect for honey yield and
calmness. These functions also take an <code>nInd</code> argument to
sample a number of individuals along with their values.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt;   yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 6        8.449952         0.1019476      0.1888765       -0.1281662</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt;   yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 7        9.173807         0.2329808      0.2608259       0.05571328</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`3`</span></span>
<span><span class="co">#&gt;   yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 8        10.38413        0.02326839       1.117594      -0.02187516</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`</span></span>
<span><span class="co">#&gt;   yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 9        7.452672        0.09161275       1.513784      -0.03131942</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPheno.html">getWorkersPheno</a></span><span class="op">(</span><span class="va">apiary</span>, nInd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt;     yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 521        9.541640      0.3136093891      0.6234074     -0.127712467</span></span>
<span><span class="co">#&gt; 522        9.763204      0.0006989786      3.3986154      0.005253285</span></span>
<span><span class="co">#&gt; 523        7.449046      0.1398718854     -1.7404113     -0.191956742</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt;     yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 721        7.805577       -0.15549894      3.0880661       0.09773962</span></span>
<span><span class="co">#&gt; 722        9.908565        0.01093518     -2.0702857       0.31876537</span></span>
<span><span class="co">#&gt; 723       13.164021        0.13750239     -0.4507371       0.48908945</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`3`</span></span>
<span><span class="co">#&gt;     yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 921       12.346598         0.3115451      0.7480086     -0.003899603</span></span>
<span><span class="co">#&gt; 922        5.102156         0.1678927      3.0885971      0.238594104</span></span>
<span><span class="co">#&gt; 923       12.264640         0.1384123      1.9185503      0.237303932</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`</span></span>
<span><span class="co">#&gt;      yieldQueenTrait yieldWorkersTrait calmQueenTrait calmWorkersTrait</span></span>
<span><span class="co">#&gt; 1121        9.001176        0.07551244      2.0420717     -0.034092447</span></span>
<span><span class="co">#&gt; 1122        9.330985       -0.16410837      1.6027239     -0.006046625</span></span>
<span><span class="co">#&gt; 1123        6.575983       -0.07163260     -0.8634309      0.112196809</span></span></code></pre></div>
<p>Now, we calculate colony genetic and phenotypic values for all
colonies in the apiary. Since we are simulating two traits, honey yield
and calmness, we have two ways to calculate corresponding colony values.
The first way is to use the default <code>mapCasteToColony*()</code>
function in <code>calcColony*()</code> and only define additional
arguments as shown here:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colonyValues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span><span class="va">apiary</span>,</span>
<span>                                queenTrait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yieldQueenTrait"</span>, <span class="st">"calmQueenTrait"</span><span class="op">)</span>,</span>
<span>                                workersTrait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yieldWorkersTrait"</span>, <span class="st">"calmWorkersTrait"</span><span class="op">)</span>,</span>
<span>                                traitName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yield"</span>, <span class="st">"calmness"</span><span class="op">)</span>,</span>
<span>                                checkProduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">colonyValues</span></span>
<span><span class="co">#&gt;       yield   calmness</span></span>
<span><span class="co">#&gt; 1  14.28425 -2.3150823</span></span>
<span><span class="co">#&gt; 2  17.94635  5.0674648</span></span>
<span><span class="co">#&gt; 3  17.54422 -1.7826881</span></span>
<span><span class="co">#&gt; 4  11.71729  3.8026174</span></span>
<span><span class="co">#&gt; 5  11.92631 -6.0871924</span></span>
<span><span class="co">#&gt; 6   8.15962  6.3785097</span></span>
<span><span class="co">#&gt; 7  14.60195  6.0768615</span></span>
<span><span class="co">#&gt; 8  18.13982  4.4513987</span></span>
<span><span class="co">#&gt; 9  18.09688  0.4576259</span></span>
<span><span class="co">#&gt; 10 14.53103  4.5523816</span></span>
<span><span class="co">#&gt; 11 25.79953  7.6670638</span></span>
<span><span class="co">#&gt; 12 11.94371 -1.0679699</span></span>
<span><span class="co">#&gt; 13 27.80202  0.9664324</span></span>
<span><span class="co">#&gt; 14 28.55671 -1.8184361</span></span>
<span><span class="co">#&gt; 15 26.11441 -2.4615074</span></span></code></pre></div>
<p>The second way is to create our own mapping function. An equivalent
outcome to the above is shown below just to demonstrate use of your own
function, but we are simply just reusing
<code><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyPheno()</a></code> twice;)</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMapCasteToColonyPheno</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">colony</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">yield</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyPheno</a></span><span class="op">(</span><span class="va">colony</span>,</span>
<span>                                 queenTrait <span class="op">=</span> <span class="st">"yieldQueenTrait"</span>,</span>
<span>                                 workersTrait <span class="op">=</span> <span class="st">"yieldWorkersTrait"</span>,</span>
<span>                                 traitName <span class="op">=</span> <span class="st">"yield"</span>,</span>
<span>                                 checkProduction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">calmness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapCasteToColonyValue.html">mapCasteToColonyPheno</a></span><span class="op">(</span><span class="va">colony</span>,</span>
<span>                                    queenTrait <span class="op">=</span> <span class="st">"calmQueenTrait"</span>,</span>
<span>                                    workersTrait <span class="op">=</span> <span class="st">"calmWorkersTrait"</span>,</span>
<span>                                    traitName <span class="op">=</span> <span class="st">"calmness"</span>,</span>
<span>                                    checkProduction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">yield</span>, <span class="va">calmness</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">colonyValues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span><span class="va">apiary</span>, FUN <span class="op">=</span> <span class="va">myMapCasteToColonyPheno</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">colonyValues</span></span>
<span><span class="co">#&gt;       yield   calmness</span></span>
<span><span class="co">#&gt; 1  14.28425 -2.3150823</span></span>
<span><span class="co">#&gt; 2  17.94635  5.0674648</span></span>
<span><span class="co">#&gt; 3  17.54422 -1.7826881</span></span>
<span><span class="co">#&gt; 4  11.71729  3.8026174</span></span>
<span><span class="co">#&gt; 5  11.92631 -6.0871924</span></span>
<span><span class="co">#&gt; 6   8.15962  6.3785097</span></span>
<span><span class="co">#&gt; 7  14.60195  6.0768615</span></span>
<span><span class="co">#&gt; 8  18.13982  4.4513987</span></span>
<span><span class="co">#&gt; 9  18.09688  0.4576259</span></span>
<span><span class="co">#&gt; 10 14.53103  4.5523816</span></span>
<span><span class="co">#&gt; 11 25.79953  7.6670638</span></span>
<span><span class="co">#&gt; 12 11.94371 -1.0679699</span></span>
<span><span class="co">#&gt; 13 27.80202  0.9664324</span></span>
<span><span class="co">#&gt; 14 28.55671 -1.8184361</span></span>
<span><span class="co">#&gt; 15 26.11441 -2.4615074</span></span></code></pre></div>
<p>Again, we can now select the best colony based on the best phenotypic
value for either yield, calmness, or an index of both. Let’s say that
both traits are equally important so we select on a weighted sum of both
of them - we will use the AlphaSimR <code><a href="https://gaynorr.github.io/AlphaSimR/reference/selIndex.html" class="external-link">selIndex()</a></code> function
that enables this calculation along with scaling. We will represent the
index such that it has a mean of 100 and standard deviation of 10
units.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colonyValues</span><span class="op">$</span><span class="va">Index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://gaynorr.github.io/AlphaSimR/reference/selIndex.html" class="external-link">selIndex</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">colonyValues</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">100</span></span>
<span><span class="va">bestColony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectColonies.html">selectColonies</a></span><span class="op">(</span><span class="va">apiary</span>, n <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="va">colonyValues</span><span class="op">$</span><span class="va">Index</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/getId.html">getId</a></span><span class="op">(</span><span class="va">bestColony</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 11</span></span></code></pre></div>
<p>We see that we selected colony with ID “4”, but we would be selecting
a different colony based on different selection criteria (yield,
calmness, or index).</p>
</div>
<div class="section level2">
<h2 id="strength-and-honey-yield">Strength and honey yield<a class="anchor" aria-label="anchor" href="#strength-and-honey-yield"></a>
</h2>
<p>In this section we change simulation to two traits where the
phenotype realisation of the first trait affects the phenotype
realisation of the second trait. Specifically, we will assume that
queen’s fecundity, and hence the number of workers, is under the genetic
affect of the queen and her environment. Furthermore, we will assume as
before that colony honey yield is due to the queen effect and workers
effect. Since the value of the workers effect depends on then number of
workers, we obtain correlation between fecundity and honey yield, even
if these traits would be uncorrelated on the queen level. We emphasise
that this is just an example and the biology of these traits might be
different.</p>
<p>We follow the same logic as before and simulate three traits that
will contribute to two colony traits, queen’s fecundity, that is colony
strength, and honey yield. We assume that fecundity is only due to the
queen (and not the workers), hence we simulate only the queen effect for
this trait. For honey yield we again assume that both the queen and
workers contribute to the colony value. For speed of simulation we only
simulate 100 workers per colony on average and split honey yield mean
between the queen and workers. We measure fecundity with the number of
workers, which is a count variable and for such variables Poisson
distribution is a good model. This distribution has just one parameter
(lambda) that represents both the mean and variance of the variable. To
this end we set phenotypic variance to 100 and split it into 25 for
genetic and 65 for environmental variance. As before we warn that these
are just exemplary values to demonstrate the code functionality and do
not necessarily reflect published values!</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Global simulation parameters</span></span>
<span><span class="va">SP</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimParamBee.html">SimParamBee</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quantitative genetic parameters</span></span>
<span><span class="co"># - the first trait has only the queen effect</span></span>
<span><span class="co"># - the second trait has both the queen and workers effects</span></span>
<span><span class="va">nWorkers</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nWorkers</span>, <span class="fl">10</span>, <span class="fl">10</span> <span class="op">/</span> <span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">varA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>,  <span class="fl">0.0</span>,  <span class="fl">0.0</span>,</span>
<span>                        <span class="fl">0.0</span>,  <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>, </span>
<span>                        <span class="fl">0.0</span>, <span class="op">-</span><span class="fl">0.5</span>,  <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">addTraitA</span><span class="op">(</span>nQtlPerChr <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="va">mean</span>, var <span class="op">=</span> <span class="va">varA</span>, corA <span class="op">=</span> <span class="va">corA</span>,</span>
<span>             name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fecundityQueenTrait"</span>, <span class="st">"yieldQueenTrait"</span>, <span class="st">"yieldWorkersTrait"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">varE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">3</span>, <span class="fl">3</span> <span class="op">/</span> <span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>,</span>
<span>                        <span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.3</span>,</span>
<span>                        <span class="fl">0.0</span>, <span class="fl">0.3</span>, <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">setVarE</span><span class="op">(</span>varE <span class="op">=</span> <span class="va">varE</span>, corE <span class="op">=</span> <span class="va">corE</span><span class="op">)</span></span></code></pre></div>
<p>We continue by creating an apiary with 10 colonies.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basePop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createVirginQueens</a></span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span><span class="va">drones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createDrones</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basePop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, nInd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMultiColony.html">createMultiColony</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">droneGroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pullDroneGroupsFromDCA.html">pullDroneGroupsFromDCA</a></span><span class="op">(</span><span class="va">drones</span>, <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span>, nDrones <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">apiary</span>, drones <span class="op">=</span> <span class="va">droneGroups</span>, checkCross <span class="op">=</span> <span class="st">"warning"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s explore queen’s genetic and phenotypic values for fecundity and
honey yield. The below printouts show quite some variation in fecundity
between queens at the genetic, but particularly phenotypic level. This
is a small example, so we should not put too much into correlations
between these three variables. However, if you restart this simulation
many times, you will notice zero correlation on average between
<code>fecundityQueenTrait</code> and the other two traits and negative
correlation on average between <code>yieldQueenTrait</code> and
<code>yieldWorkersTrait.</code> Just like we defined in the global
simulation parameters.</p>
<pre><code><span><span class="co">#&gt;    fecundityQueenTrait yieldQueenTrait yieldWorkersTrait</span></span>
<span><span class="co">#&gt; 6            105.48275        9.249839       0.292411998</span></span>
<span><span class="co">#&gt; 7            102.07825        9.534317       0.161117509</span></span>
<span><span class="co">#&gt; 8             96.23186        9.738127      -0.061018067</span></span>
<span><span class="co">#&gt; 9             99.52867       10.364281       0.118325627</span></span>
<span><span class="co">#&gt; 10           103.03431        8.708065       0.205995640</span></span>
<span><span class="co">#&gt; 11           107.88132       12.453251      -0.001595573</span></span>
<span><span class="co">#&gt; 12            94.18071        9.967347       0.168993849</span></span>
<span><span class="co">#&gt; 13           104.21334        9.892984       0.203154233</span></span>
<span><span class="co">#&gt; 14            94.68714        8.459328       0.116470944</span></span>
<span><span class="co">#&gt; 15           103.65858       10.684706       0.119864761</span></span>
<span><span class="co">#&gt; 16            99.57587        9.722972      -0.049601287</span></span>
<span><span class="co">#&gt; 17            97.88445        9.568260       0.096565172</span></span>
<span><span class="co">#&gt; 18           111.01697        8.201513       0.230384022</span></span>
<span><span class="co">#&gt; 19            94.62652        9.502991      -0.009232564</span></span>
<span><span class="co">#&gt; 20           105.86031       10.485496       0.145087784</span></span>
<span><span class="co">#&gt;                     fecundityQueenTrait yieldQueenTrait yieldWorkersTrait</span></span>
<span><span class="co">#&gt; fecundityQueenTrait           1.0000000     -0.41094433        0.30465060</span></span>
<span><span class="co">#&gt; yieldQueenTrait              -0.4109443      1.00000000       -0.07608885</span></span>
<span><span class="co">#&gt; yieldWorkersTrait             0.3046506     -0.07608885        1.00000000</span></span></code></pre>
<p><img src="F_Quantitative_Genetics_files/figure-html/queen_values-1.png" width="576"></p>
<p>We next build-up colonies in the apiary. But instead of building them
all up to the same fixed number of workers, we build them up according
to queen’s fecundity. For that we use the sampling function
<code><a href="../reference/nWorkersFun.html">nWorkersColonyPhenotype()</a></code>, that samples the number of
workers based on phenotypes of colony members, in our case
<code>fecundityQueenTrait</code> in queens. Correspondingly, each colony
will have a different number of workers. Read more about this function
in it’s help page.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">apiary</span>, nWorkers <span class="op">=</span> <span class="va">nWorkersColonyPhenotype</span>,</span>
<span>                  queenTrait <span class="op">=</span> <span class="st">"fecundityQueenTrait"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>nWorkers <span class="op">=</span> <span class="fu"><a href="../reference/nCaste.html">nWorkers</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span>, <span class="va">queenPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt;    nWorkers fecundityQueenTrait yieldQueenTrait yieldWorkersTrait</span></span>
<span><span class="co">#&gt; 1       118           118.46084        9.424673       0.430196546</span></span>
<span><span class="co">#&gt; 2       109           108.82042        9.577119       0.166746016</span></span>
<span><span class="co">#&gt; 3        90            92.07771        9.376285       0.002436991</span></span>
<span><span class="co">#&gt; 4       109           108.70008        9.991455      -0.140097093</span></span>
<span><span class="co">#&gt; 5       132           131.70061        6.908129       0.303889300</span></span>
<span><span class="co">#&gt; 6       113           113.38884       13.401285      -0.122053563</span></span>
<span><span class="co">#&gt; 7        79            78.83550       13.998479       0.143453411</span></span>
<span><span class="co">#&gt; 8       111           111.41684       13.215164       0.338735714</span></span>
<span><span class="co">#&gt; 9       112           111.79845        7.409427       0.037872466</span></span>
<span><span class="co">#&gt; 10       97            97.15756       12.999626       0.018324700</span></span>
<span><span class="co">#&gt; 11       89            93.13744       10.956465       0.187470625</span></span>
<span><span class="co">#&gt; 12       89            88.91209        7.618602      -0.054869114</span></span>
<span><span class="co">#&gt; 13      121           121.27583        8.561806       0.298385073</span></span>
<span><span class="co">#&gt; 14      103           102.95987        9.794005       0.091551360</span></span>
<span><span class="co">#&gt; 15      116           115.50199        9.732659      -0.168091718</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">nWorkersColonyPhenotype</span><span class="op">)</span></span></code></pre></div>
<p>To compute the colony value for honey yield, we again employ the
<code><a href="../reference/calcColonyValue.html">calcColonyPheno()</a></code> function. Correlating the queen and
colony values we will now see a positive correlation because our
individual to colony mapping function sums workers effect across all
workers and the more workers there are the larger the sum.</p>
<pre><code><span><span class="co">#&gt;                       nWorkers fecundityQueenTrait yieldQueenTrait</span></span>
<span><span class="co">#&gt; nWorkers             1.0000000           0.9969492     -0.40942496</span></span>
<span><span class="co">#&gt; fecundityQueenTrait  0.9969492           1.0000000     -0.41094433</span></span>
<span><span class="co">#&gt; yieldQueenTrait     -0.4094250          -0.4109443      1.00000000</span></span>
<span><span class="co">#&gt; yieldWorkersTrait    0.2818321           0.3046506     -0.07608885</span></span>
<span><span class="co">#&gt; yield                0.5299973           0.5047996      0.14994636</span></span>
<span><span class="co">#&gt;                     yieldWorkersTrait     yield</span></span>
<span><span class="co">#&gt; nWorkers                   0.28183208 0.5299973</span></span>
<span><span class="co">#&gt; fecundityQueenTrait        0.30465060 0.5047996</span></span>
<span><span class="co">#&gt; yieldQueenTrait           -0.07608885 0.1499464</span></span>
<span><span class="co">#&gt; yieldWorkersTrait          1.00000000 0.4936471</span></span>
<span><span class="co">#&gt; yield                      0.49364708 1.0000000</span></span></code></pre>
<p><img src="F_Quantitative_Genetics_files/figure-html/colony_pheno_3-1.png" width="624"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jana Obšteter, Laura Strachan, Jernej Bubnič, Gregor Gorjanc.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
